% \chapter{Learning Proprioception for Continuum Soft Robots with Magnetic Sensors}
\chapter{Exploiting Learned Magnetic Fields and Kinematic Models for Shape Sensing}
\label{chp:promasens}

\begin{foreword}
    % Proprioception of its own state is a necessity for (soft) robots that enables many downstream applications such as control, motion planning, etc.
    % In Chapter~\ref{chp:srslam}, we presented an approach that executes kinematics-aware \gls{SLAM} on images from monocular cameras attached to the soft robot's body.
    % However, the presented approach also has some drawbacks: 
    % i) Firstly, while cameras have been significantly miniaturized in recent years, the requirement for them to have a clear, unobstructed view of the environment necessitates the inclusion of a rigid component on the surface of the soft robot, which we generally prefer to avoid for safety reasons. 
    % Secondly, ii), the performance of \gls{SLAM} algorithms is affected in environments with limited visually distinguishable features.
    % Finally, iii) high-dimensional perceptive data such as images are generally computationally expensive to process, leading to higher computational requirements and/or relatively low sampling rates of the shape-sensing information.
    % Therefore, we present in this chapter an alternative proprioception approach based on magnetic sensors. The necessary magnets and magnetic sensors can be deeply embedded into the soft robot body, thus allowing us to keep the robot surface entirely soft and compliant. Furthermore, the sensory data is several orders of magnitude lower dimensional, and thus, its processing is potentially much less computationally demanding.
    Proprioception is essential for (soft) robots, enabling applications like control and motion planning. In Chapter~\circled{\ref{chp:srslam}}, we introduced a kinematics-aware \gls{SLAM} approach based on images from a monocular camera attached to the robot. However, this method has drawbacks: i) Cameras, despite their miniaturization, require a clear, unobstructed view, necessitating rigid components on the robot’s surface, which potentially compromises safety. ii) \gls{SLAM} algorithms perform poorly in environments with few visually distinguishable features. iii) Processing high-dimensional image data is computationally intensive, leading to higher processing demands and/or lower shape-sensing sampling rates. To address these issues, this chapter proposes an alternative proprioception method using magnetic sensors. These sensors, along with embedded magnets, can be fully integrated into the robot’s body, maintaining a soft, compliant surface. Additionally, the sensory data is much lower-dimensional, making it significantly less computationally demanding to process.
    However, the complex nature of magnetic fields makes the mapping from magnetic sensor readings to shape information very challenging, and it would be very hard to develop a fully physics-based model to help us interpret the sensor readings. Instead, we leverage modern \gls{ML} methods for this task.
    Akin to projecting the \gls{SLAM} pose measurements onto the kinematic model (Chapter~\circled{\ref{chp:srslam}}), we again leverage here kinematic knowledge to simplify the problem setting. 
    Specifically, instead of learning proprioception end-to-end from magnetic sensor measurements to configuration values, we simplify the learning problem by asking a neural network to predict the measurements of a sensor given a parametrization of the spatial relation between the magnetic sensor and all magnets embedded in the robot. We present the proposed methodology in detail in Sec.~\ref{sec:promasens:methodology}.
    We verify the proposed approach extensively in simulations based on \gls{PCC}- \& \gls{PAC}-parametrized soft robots (Section~\ref{sec:promasens:pcc_simulations} \& \ref{sec:promasens:ac_simulations}), and experimentally in Section~\ref{sec:promasens:experiments} on a one-segment soft robot moving in 3D space.
\end{foreword}

\blfootnote{This chapter is partly based on \faFileTextO~\emph{T. Baaij*, M. K. Holkenborg*, \textbf{M. Stölzle}*, D. van der Tuin*, J. Naaktgeboren, R. Babuška, and C. Della Santina (2023). Learning 3D shape proprioception for continuum soft robots with multiple magnetic sensors. Soft Matter, 19(1), 44-56}~\cite{baaij2023learning}.
}


\pagebreak

\begin{abstract}
    Sensing the shape of continuum soft robots without obstructing their movements and modifying their natural softness requires innovative solutions. This chapter proposes to use magnetic sensors that are fully integrated into the robot to achieve proprioception. Magnetic sensors are compact, sensitive, and easy to integrate into a soft robot. We also propose a neural architecture to make sense of the highly nonlinear relationship between the perceived intensity of the magnetic field and the shape of the robot. By injecting a priori knowledge from the kinematic model, we obtain an effective yet data-efficient learning strategy. We first demonstrate in simulation the value of this kinematic prior by investigating the proprioception behavior when varying the sensor configuration, which does not require us to re-train the neural network. We validate our approach in experiments involving one soft segment containing a cylindrical magnet and three magnetoresistive sensors. During the experiments, we achieve mean relative errors of 4.5\%.
\end{abstract}

%% Start the actual chapter on a new page.
\newpage

\input{promasens/sections/S01_introduction}
\input{promasens/sections/S02_methodology}
\input{promasens/sections/S03_pcc_simulations}
\input{promasens/sections/S04_ac_simulations}
\input{promasens/sections/S05_experiments}
\input{promasens/sections/S06_conclusion}

\section*{Afterword}
This chapter presented an example of how prior knowledge, in this case, a soft robot kinematic model, can be leveraged to simplify a learning problem, which in turn improves the data efficiency of the learning, as we drastically reduced the number of inputs and outputs compared to a naive solution of learning proprioception end-to-end.
Essentially, the prior knowledge here allowed us to reduce the size of the learned \emph{black-box} by pulling out the kinematics.
In the following two chapters, Chapters~\circled{\ref{chp:pcsregression}} \& \circled{\ref{chp:con}}, we again strive to leverage prior knowledge, this time for learning the dynamics of soft robots.
Contrary to this chapter, instead of reducing the size of the \emph{black-box}, we endeavor towards a \emph{grey-box} model that incorporates physical structure and exhibits certain stability guarantees.