\section{Euler-Lagrangian Dynamics}\label{sec:background:dynamics}
% In the following, we will introduce the form and most important characteristics of the dynamics of continuum soft robots formulated in Euler-Lagrangian form.
% For a detailed discussion on the derivation of the dynamics, we point the interested reader to several (survey) papers in literature~\citep{gazzola2018forward, armanini2023soft, alessi2024rod, della2023model}.
In the following section, we introduce the structure and key characteristics of continuum soft robot dynamics, formulated in Euler-Lagrangian form. For a detailed derivation of these dynamics, readers are referred to several survey papers in the literature~\citep{gazzola2018forward, armanini2023soft, alessi2024rod, della2023model}.

% Irrespective of the specific chosen kinematic parameterization, the \gls{EOM} of a soft can, in most cases, be stated in Euler-Lagrangian form~\citep{della2023model}:
% \begin{equation}\label{eq:background:dynamics:eom}
%     M(q) \, \ddot{q} + C(q, \dot{q}) \, \dot{q} + K(q) + G(q) + D \, \dot{q} = \alpha(q,\tau) = A(q) \, \tau,
% \end{equation}
% where the mass matrix $M(q) \succeq 0 \in \mathbb{R}^{n \times n}$
% % \footnote{Note that in some chapters of this thesis, we also use the symbol $M(q)$ to refer to the mass matrix $B(q)$.} 
% captures the inertia of the robot, $C(q,\dot{q}) \in \mathbb{R}^{n \times n}$ integrates the Coriolis and centrifugal effects, $K(q), G(q) \in \mathbb{R}^{n}$ contribute elastic and gravitational forces, respectively, and $D \succeq 0$ is the damping matrix.
% The model verifies similar properties as traditional rigid robots, such that the expression $\dot{M}(q) - 2 \, C(q,\dot{q})$ is skew-symmetric, as long as $C(q,\dot{q})$ is defined with Christoffel symbols~\citep{della2020model}.
% We assume that the soft robot is driven by $m$ actuators through the term $\alpha: q \times \tau \mapsto A(q) \, \tau$, where $A(q) \in \mathbb{R}^{n \times m}$. \footnote{We note while this control-affine formulation with a configuration-dependent actuation matrix $A(q)$ can capture the characteristics of most currently existing soft robots actuation methods, such as pneumatic or tendon-driven actuation, the actuation can also become a more general nonlinear function $\alpha(q,\tau)$, such as it is the case for the \gls{HSA} robot actuation model presented in Chapter~\ref{chp:hsamodel}. Furthermore, when additionally considering the actuator dynamics, as in Chapter~\ref{chp:backstepping} for pneumatic pistons, the generalized actuation torque is possibly also a function of the actuator's state $(\mu,\dot{\mu})$.}
% If $n=m$, the robot model is considered to be fully actuated; if $n < m$ (rather rare), the soft robot is called overactuated~\citep{pustina2024input}; and if $n > m$, the soft robot model is referred to as underactuated~\citep{pustina2025analysis}.

Regardless of the chosen kinematic parameterization, the \glspl{EOM} for a soft robot can generally be expressed in Euler-Lagrangian form~\citep{della2023model}:
\begin{equation}\label{eq:background:dynamics:eom}
M(q) \, \ddot{q} + C(q, \dot{q}) \, \dot{q} + K(q) + G(q) + D \, \dot{q} = A(q) \, \tau,
\end{equation}
where the mass matrix $M(q) \succ 0 \in \mathbb{R}^{n \times n}$ represents the robot’s inertia, $C(q,\dot{q}) \in \mathbb{R}^{n \times n}$ accounts for Coriolis and centrifugal effects, $K(q)$ and $G(q)$ (in $\mathbb{R}^{n}$) correspond to elastic and gravitational forces, respectively, and $D \succ 0$ is the damping matrix. This model shares properties with traditional rigid robot dynamics, such as the skew-symmetry of $\dot{M}(q) - 2 \, C(q,\dot{q})$, provided that $C(q,\dot{q})$ is defined using Christoffel symbols~\citep{della2020model}.

We assume that the soft robot is actuated by $m$ actuators via the mapping $\alpha: q \times \tau \mapsto A(q) \, \tau$, where $A(q) \in \mathbb{R}^{n \times m}$.
\footnote{While this control-affine formulation with a configuration-dependent actuation matrix $A(q)$ captures the characteristics of most existing soft robot actuation methods—such as pneumatic or tendon-driven actuation—the actuation can also be represented as a more general nonlinear function $\alpha(q,\tau)$, as is the case for the \gls{HSA} robot actuation model presented in Chapter~\ref{chp:hsamodel}. Furthermore, when accounting for actuator dynamics, as discussed in Chapter~\ref{chp:backstepping} for pneumatic pistons, the generalized actuation torque may also depend on the actuator’s state $(\mu,\dot{\mu})$.}
Depending on the relationship between $n$ and $m$, if $n=m$, the robot is fully actuated; if $n < m$ (which is less common), it is considered overactuated~\citep{pustina2024input}; and if $n > m$, the soft robot is regarded as underactuated~\citep{pustina2025analysis}.

\subsection{Formulation as a 1st-Order Ordinary Differential Equation (ODE)}
After defining the state of the soft robot as $y = \begin{bmatrix}
    q^\top & \dot{q}^\top
\end{bmatrix}^\top \in \mathbb{R}^{2n}$, \eqref{eq:background:dynamics:eom} can be expressed as a control-affine \gls{ODE} in nonlinear state-space representation
\begin{equation}
    \dot{y} = f(y,\tau) = \begin{bmatrix}
        \frac{\mathrm{d} q}{\mathrm{d}t}\\
        \frac{\mathrm{d} \dot{q}}{\mathrm{d}t}\\
    \end{bmatrix} = \begin{bmatrix}
        \dot{q}\\
        -M^{-1}(q) \left ( C(q,\dot{q}) \, \dot{q} + K(q) + G(q) + D \, \dot{q} \right )
    \end{bmatrix} + \underbrace{\begin{bmatrix}
        0_{n \times m}\\ M^{-1}(q) \, A(q)
    \end{bmatrix}}_{B(q)} \, \tau.
\end{equation}

\subsection{Kinetic and Potential Energy}
% Usually, we can derive analytically the kinetic and potential energy of the system
Typically, we can derive analytical expressions for the system’s kinetic and potential energy:
\begin{equation}
    \mathcal{T}(q,\dot{q}) = \frac{1}{2} \dot{q}^\top M(q) \, \dot{q},
    \qquad
    \mathcal{U}(q) = \mathcal{U}_\mathrm{K}(q) + \mathcal{U}_\mathrm{G}(q) = \int K(q) + G(q) \, \mathrm{d}q,
\end{equation}
where $\mathcal{T}(q,\dot{q}) \geq 0$ is the kinetic and $\mathcal{U}(q)$ the potential energy consisting of elastic and gravitational terms $\mathcal{U}_\mathrm{K}(q)$, $\mathcal{U}_\mathrm{G}(q)$.
which results in $K(q) + G(q) = \frac{\partial \mathcal{U}}{\partial q}$. 
In the case of linear elasticity $K(q) = S \, q$, where $S \succ 0 \in \mathbb{R}^{n \times n}$ is the stiffness of the generalized coordinates, the elastic potential energy becomes $\mathcal{U}_\mathrm{K}(q) = \frac{1}{2} q^\top S \, q$.
Consequently, the Lagrangian is defined as $\mathcal{L}(q,\dot{q}) = \mathcal{T}(q,\dot{q}) - \mathcal{U}(q)$.

% As seen in \citet{della2020model, della2023model} and Chapters~\ref{chp:backstepping} \& \ref{chp:con}, this energy field can serve as a starting point for analyzing the stability of the open- and closed-loop system using Lyapunov arguments~\citep{khalil2002nonlinear}.
As demonstrated by \citet{della2020model, della2023model} and in Chapters~\ref{chp:backstepping} and \ref{chp:con}, these energetic expressions provide a solid foundation for analyzing the stability of both open- and closed-loop systems using Lyapunov arguments~\citep{khalil2002nonlinear}.

\subsection{Operational Space Dynamics}\label{sub:background:dynamics:operational_space}
% As initially proposed in the seminal work by \citet{khatib1987unified} and later adopted to soft robots by \citet{della2020model}, the dynamics of the system can be directly expressed in operational space\footnote{The task space is often also referred to as operational space. As oftentimes end-effectors (e.g., grippers) are attached to the distal end of the robot, the operational space is usually defined as the pose $\chi \in SE(3)$ of the end-effector.}
% Irrespective of the exact definition of the operational space (e.g., end-effector pose), for the given forward kinematics $\pi: q \mapsto x$, where $x \in \mathbb{R}^o$ is the operational space coordinate with $o \leq n$, and the associated Jacobian $J(q) = \frac{\partial \pi}{\partial q} \in \mathbb{R}^{o \times n}$, \eqref{eq:background:dynamics:eom} can be equivalently expressed in operational space as
As originally proposed in the seminal work by \citet{khatib1987unified} and later adapted for soft robots by \citet{della2020model}, the system dynamics can be directly expressed in operational space\footnote{The operational space is also commonly referred to as task space. Since end-effectors (e.g., grippers) are typically attached to the distal end of the robot, the operational space is often defined by the pose $\chi \in SE(3)$ of the end-effector.}. Regardless of the precise definition of operational space (e.g., end-effector pose), given the forward kinematics $\pi: q \mapsto x$, where $x \in \mathbb{R}^o$ denotes the operational space coordinate with $o \leq n$, and the corresponding Jacobian $J(q) = \frac{\partial \pi}{\partial q} \in \mathbb{R}^{o \times n}$, \eqref{eq:background:dynamics:eom} can equivalently be written in operational space as
\begin{equation}\label{eq:background:dynamics:eom_operational_space}
    \Lambda_\mathrm{x}(q) \, \ddot{x} + \eta_\mathrm{x}(q, \dot{q}) \, \dot{q} + J_\mathrm{M}^{+\top}(q) \left ( G(q) + K(q) + D \, \dot{q} \right ) = J_\mathrm{M}^{+^\top}(q) \, A(q) \, \tau,
\end{equation}
where 
\begin{equation}
    J_\mathrm{M}^{+}(q) = M^{-1}(q) \, J^\top(q) \left ( J(q) \, M^{-1}(q) \, J^\top(q) \right )^{-1} \in \mathbb{R}^{n \times o},
\end{equation}
% is the dynamically consistent pseudo-inverse~\citep{chang1995manipulator}, which can be used to map operational space velocities into configuration space and generalized torques into operational space,
denotes the dynamically consistent pseudo-inverse~\citep{chang1995manipulator}, which maps operational space velocities to configuration space and transforms generalized torques into operational space. Moreover,
\begin{equation}
    \Lambda_\mathrm{x}(q) = \left ( J(q) \, M^{-1}(q) \, J^\top(q) \right )^{-1} \in \mathbb{R}^{o \times o},
\end{equation}
% is the operational space inertia matrix, and the operational space Coriolis and centrifugal matrix $\eta(q, \dot{q})$\footnote{Please note that in Chapter~\ref{chp:hsacontrol} we refer to this operational space as $\mu(q,\dot{q})$.} is defined as~\citep{khatib1987unified, della2020model}
defines the operational space inertia matrix, and the operational space Coriolis and centrifugal matrix $\eta(q, \dot{q})$\footnote{Please note that in Chapter~\ref{chp:hsacontrol} this operational space Coriolis matrix is denoted as $\mu(q,\dot{q})$.} is defined as~\citep{khatib1987unified, della2020model}
\begin{equation}
    \eta_\mathrm{x}(q, \dot{q}) = \Lambda(q) \, \left ( J(q) \, M^{-1}(q) \, C(q,\dot{q}) - \dot{J}(q,\dot{q}) \right ) \in \mathbb{R}^{o \times o}.
\end{equation}

\subsubsection{Null Space Dynamics}
% When $o < n$, there exists $n-o$ redundant dynamics - also called the null space dynamics~\citep{siciliano2010robotics}. It is very important to also consider the characteristics of the null space dynamics to ensure, for example, the stability of the closed-loop robotic system and not just the operational space movement of the end-effector.
% In literature, various approaches exist for deriving such null space dynamics, ranging from projection- to operational space augmentation methods~\citep{ott2008cartesian}.
% In the following, we will focus on the \emph{Joint Space Decomposition Method}~\citep{ott2008cartesian}.
When $o < n$, there are $(n-o)$ redundant \glspl{DOF}—commonly known as the null space dynamics~\citep{siciliano2010robotics}. It is crucial to consider these null space dynamics to ensure, for instance, the stability of the closed-loop robotic system rather than focusing solely on the end-effector’s operational space movement. Various approaches in the literature address the derivation of null space dynamics, ranging from projection-based methods to operational space augmentation techniques~\citep{ott2008cartesian}. In the following, we focus on the \emph{Joint Space Decomposition Method}~\citep{ott2008cartesian}.

% First, we introduce the additional nullspace velocities $\nu_\mathrm{n} = N(q) \, \dot{q} \in \mathbb{R}^{n-o}$, that are the time derivatives of the null space coordinates $n(t) \in \mathbb{R}^{n-o}$\footnote{Please note that we can always recover the nullspace coordinates by integration via $n(t) = \int_0^t \nu_\mathrm{n}(t') \, \mathrm{d}t'$, although they might not exhibit any geometric meaning~\cite{ott2008cartesian}.}, with a suitable choice of $N(q) \in \mathbb{R}^{(n-o= \times n}$, resulting in~\citep{ott2008cartesian, della2020model}
First, we introduce the additional null space velocities defined as $\nu_\mathrm{n} = N(q) \, \dot{q} \in \mathbb{R}^{n-o}$, which represent the time derivatives of the null space coordinates $n(t) \in \mathbb{R}^{n-o}$ \footnote{Note that the null space coordinates can always be recovered via integration, i.e.,  $n(t) = \int_0^t \nu_\mathrm{n}(t{\prime}) \, \mathrm{d}t{\prime}$, although they may not have a direct geometric interpretation~\citep{ott2008cartesian}.}. With an appropriate choice of  $N(q) \in \mathbb{R}^{(n-o) \times n}$, this yields the formulation described in~\citep{ott2008cartesian, della2020model}.
\begin{equation}
    \begin{bmatrix}
        \dot{x}\\
        \nu_\mathrm{n}
    \end{bmatrix} = \begin{bmatrix}
        J(q)\\
        N(q)
    \end{bmatrix} \, \dot{q},
\end{equation}
where for the nullspace base matrix $Z(q) \in \mathbb{R}^{(n-o) \times n}$ we define~\citep{ott2008cartesian}
\begin{equation}
    N(q) = \left ( Z(q) \, M(q) \, Z(q)^\top \right )^{-1} \, Z(q) \, M(q).
\end{equation}
In the general case, $Z(q)$ can be constructed as~\citep{huang1991optimal, ott2008cartesian}
\begin{equation}
    Z(q) = \begin{bmatrix}
        -J_\mathrm{n-o}^\top(q) \, J_\mathrm{o}^{-\top} & \mathbb{I}_{n-o}
    \end{bmatrix},
\end{equation}
for which we partitioned the Jacobian $J(q)$ as 
\begin{equation}
    J(q) = \begin{bmatrix}
        J_\mathrm{o} & J_\mathrm{n-o}
    \end{bmatrix} \in \mathbb{R}^{o \times n},
\end{equation}
such that $J_\mathrm{o}(q) \in \mathbb{R}^{o \times o}$ is at least locally invertible.

The \gls{EOM} of the combined operational and null space dynamics are now given as~\citep{ott2008cartesian}
\begin{equation}\small
    \underbrace{\begin{bmatrix}
        \Lambda_\mathrm{x}(q) & 0_{o \times (n-o)}\\
        0_{(n-o) \times o} & \Lambda_\mathrm{n}(q)
    \end{bmatrix}}_{\Lambda(q) \in \mathbb{R}^{n \times n}} \, \begin{bmatrix}
        \ddot{x}\\
        \dot{\nu}_\mathrm{n}
    \end{bmatrix} + \underbrace{\begin{bmatrix}
        \eta_\mathrm{x}(q, \dot{q})\\
        \eta_\mathrm{n}(q, \dot{q})
    \end{bmatrix}}_{\eta(q,\dot{q}) \in \mathbb{R}^{n \times n} } \, \dot{q} + \underbrace{\begin{bmatrix}
        J_\mathrm{M}^{+\top}(q)\\
        Z(q)
    \end{bmatrix}}_{J_\mathrm{MZ}^\top(q) \in \mathbb{R}^{n \times n}} \, \left ( G(q) + K(q) + D \, \dot{q} \right ) = \begin{bmatrix}
        f_\mathrm{x}\\ f_\mathrm{n}
    \end{bmatrix} = J_\mathrm{MZ}^\top(q) \, A(q) \, \tau,
\end{equation}
where $J_\mathrm{MZ}(q)$ can be used to map operational and null space velocities into configuration space~\citep{ott2008cartesian}
\begin{equation}
    \dot{q}(t) = \underbrace{\begin{bmatrix}
        J_\mathrm{M}^{+}(q)\\
        Z(q)
    \end{bmatrix}}_{J_\mathrm{MZ}(q)} \, \begin{bmatrix}
        \dot{x}(t)\\ \nu_\mathrm{n}(t)
    \end{bmatrix},
\end{equation}
which allows us to decompose $\eta(q,\dot{q}) \, \dot{q}$ into
\begin{equation}
    \eta(q,\dot{q}) \, \dot{q} = \begin{bmatrix}
        \eta_\mathrm{xx}(q,\dot{q}) & \eta_\mathrm{xn}(q,\dot{q})\\
        \eta_\mathrm{nx}(q,\dot{q}) & \eta_\mathrm{nn}(q,\dot{q})
    \end{bmatrix} \, \begin{bmatrix}
        \dot{x}\\ \nu_\mathrm{n}
    \end{bmatrix},
\end{equation}
where
\begin{equation}
\begin{split}
    \eta_\mathrm{xx}(q,\dot{q}) = \eta_\mathrm{x}(q,\dot{q}) \, J_\mathrm{M}^{+}(q),
    \qquad
    \eta_\mathrm{xn}(q,\dot{q}) = \eta_\mathrm{x}(q,\dot{q}) \, Z(q),\\
    \eta_\mathrm{nx}(q,\dot{q}) = \eta_\mathrm{n}(q,\dot{q}) \, J_\mathrm{M}^{+}(q),
    \qquad
    \eta_\mathrm{nn}(q,\dot{q}) = \eta_\mathrm{n}(q,\dot{q}) \, Z(q).\\
\end{split}
\end{equation}
Furthermore, the null space inertia $\Lambda_\mathrm{n}(q)$ is defined as~\citep{ott2008cartesian}
\begin{equation}
    \Lambda_\mathrm{n}(q) = Z(q) \, M(q) \, Z(q)^\top.
\end{equation}


\subsection{Actuation Space Dynamics}\label{sub:background:dynamics:actuation_space}
\citet{pustina2024input} demonstrated that it is often feasible to directly formulate the dynamics in actuation coordinates $\varphi \in \mathbb{R}^n$, where the actuation force $\tau$ acts directly on the first $m$ actuation coordinates via an identity matrix. This feature is especially appealing for control applications because it enables a straightforward mapping of a control input devised in the generalized (collocated) coordinates into an actuation $\tau$. Moreover, this approach may also be useful in the future in other applications such as inverse kinematics~\citep{della2025pushing} or workspace estimation. Since this collocated mapping is particularly beneficial in underactuated settings, as later demonstrated in Chapter~\ref{chp:hsacontrol}, we focus on the case $m \leq n$, which includes both fully actuated and underactuated systems.
In the following, we will assume for the actuation matrix $A(q)$ to be full-rank (i.e., $\mathrm{rank}(A) = m$).

According to \citet{pustina2024input}, there exists a transformation into collocated form when there is a function $g(q): \mathbb{R}^n \mapsto \mathbb{R}^m$ such that $\frac{\partial g}{\partial q} = A^\top (q),$
which is referred to as \emph{integrability assumption}. In practice, as shown in Sec.~\ref{sec:hsacontrol:configuration_space_regulation}), this mapping $g(q)$ is found by solving the integral $g(q) = \int_0^t \dot{q}(t')^\top \, A(q') \, \mathrm{d} t'$.
If $A(q)$ is constant, the mapping is given by $g(q) = A^\top q$~\citep{pustina2024input}.
If $m < n$, we stress that the coordinates given by $g(q)$ would not be sufficient to fully describe the dynamics of the system, as there would exist a null space of dimensionality $n-m$. Therefore, we can choose which  $n-m$ coordinates from the original configuration space to keep. For example, the following transformation into actuation coordinates would be valid for a given $g(q)$~\citep{pustina2024input}
\begin{equation}
    \varphi = \begin{bmatrix}
        \varphi_\mathrm{a}\\ \varphi_\mathrm{u}
    \end{bmatrix} = h(q) = \begin{bmatrix}
        g(q)\\ 0_{n-m}
    \end{bmatrix} + \begin{bmatrix}
        0_{m \times m} & 0_{m \times (n-m)}\\
        0_{(n-m) \times m} & \mathbb{I}_{n-m}
    \end{bmatrix} \, q,
\end{equation}
where $\varphi_\mathrm{a} \in \mathbb{R}^m$ and $\varphi_\mathrm{u} \in \mathbb{R}^{n-m}$ refer to the actuated and unactuated actuation coordinates, respectively, and the function $h(q): \mathbb{R}^{n} \to \mathbb{R}^n$ maps from configuration space into collocated form. $J_\mathrm{h}(q)$ is its associated Jacobian, and it is defined together with its inverse\footnote{We assume in this Chapter for $J_\mathrm{h}(q)$ to be either invertible for all $q \in \mathbb{R}^{n}$ or at least in the relevant workspace $q \in \mathcal{Q}$ of the soft robot.}
\begin{equation}
    J_\mathrm{h}(q) = \frac{\partial h(q)}{\partial q} = \begin{bmatrix}
        A_\mathrm{a}^\top(q) & A_\mathrm{u}^\top(q)\\
        0_{(n-m) \times m} & \mathbb{I}_{n-m}
    \end{bmatrix},
    \quad
    J_\mathrm{h}^{-1}(q) = \left ( \frac{\partial h(q)}{\partial q} \right )^{-1} = \begin{bmatrix}
        A_\mathrm{a}^{-\top}(q) & -A_\mathrm{a}^{-\top}(q) \, A_\mathrm{u}^\top(q)\\
        0_{(n-m) \times m} & \mathbb{I}_{n-m}
    \end{bmatrix},
\end{equation}
and $A_\mathrm{a}(q) \in \mathbb{R}^{m \times m}$, $A_\mathrm{u}(q) \in \mathbb{R}^{(n-m) \times m}$ stem from the following partitioning: $A(q) = \begin{bmatrix}
    A_\mathrm{a}(q)\\ A_\mathrm{u}(q)
\end{bmatrix}$.
The dynamics in actuation coordinates are then given by
\begin{equation}
    M_\varphi(q) \, \ddot{\varphi} + \eta_\varphi(q,\dot{q}) \, \dot{\varphi} + J_{\mathrm{h},\mathrm{M}}^{+\top}(q) \left ( G(q) + K(q) + D \, \dot{q} \right ) = \begin{bmatrix}
        \tau\\ 0_{n-m}
    \end{bmatrix},
\end{equation}
where analog to the operational space dynamics, the actuation space inertia is defined as~\citep{khatib1987unified}
\begin{equation}\label{eq:background:dynamics:eom_actuation_coordinates}
    M_\varphi(q) = \left ( J_\mathrm{h}(q) \, M^{-1}(q) \, J_\mathrm{h}^\top(q) \right )^{-1} = J_\mathrm{h}^{-\top}(q) \, M(q) \, J_\mathrm{h}^{-1}(q) \in \mathbb{R}^{n \times n},
\end{equation}
$J_{\mathrm{h},\mathrm{M}}^{+\top}(q) \in \mathbb{R}^{n \times n}$ is the dynamically-consistent pseudo-inverse~\citep{chang1995manipulator}
\begin{equation}
\begin{split}
    J_{\mathrm{h},\mathrm{M}}^{+}(q) % =& \: M^{-1}(q) \, J_\mathrm{h}^\top(q) \left ( J_\mathrm{h}(q) \, M^{-1}(q) \, J_\mathrm{h}^\top(q) \right )^{-1} 
    = J_\mathrm{h}^{-1}(q) = \begin{bmatrix}
        A_\mathrm{a}^{-\top}(q) & -A_\mathrm{a}^{-\top}(q) \, A_\mathrm{u}^\top(q)\\
        0_{m \times (n-m)} & \mathbb{I}_{n-m}
    \end{bmatrix},
\end{split}
\end{equation}
$\eta_\varphi(q,\dot{q})$ captures the Coriolis and centrifugal effects
\begin{equation}
    \eta_\varphi(q, \dot{q}) = M_\varphi(q) \, \left ( J_\mathrm{h}(q) \, M^{-1}(q) \, C(q,\dot{q}) - \dot{J}_\mathrm{h}(q,\dot{q}) \right ) \, J_\mathrm{h}^{-1}(q) \in \mathbb{R}^{n \times n}.
\end{equation}
The property $\dot{M}_\varphi(q) = \eta_\varphi(q,\dot{q}) + \eta^\top_\varphi(q,\dot{q})$ still holds.
Crucially, we now notice in \eqref{eq:background:dynamics:eom_actuation_coordinates} how $\tau$ directly acts via an identity actuation matrix on the first $m$ actuation coordinates.
%
We can partition the dynamics of \eqref{eq:background:dynamics:eom_actuation_coordinates} into the first $m$ (actuated) rows, and the last $n-m$ unactuated rows:
\begin{equation}\footnotesize
    \begin{bmatrix}
        M_{\varphi,\mathrm{a}}(q)\\ 
        M_{\varphi,\mathrm{u}}(q)
    \end{bmatrix} \, \ddot{\varphi} + \begin{bmatrix}
        \eta_{\varphi,\mathrm{a}}(q,\dot{q})\\ \eta_{\varphi,\mathrm{u}}(q,\dot{q})
    \end{bmatrix} \, \dot{\varphi} + \underbrace{\begin{bmatrix}
        A_\mathrm{a}^{-1}(q) & 0_{m \times (n-m)}\\
        -A_\mathrm{u}(q) \, A_\mathrm{a}^{-1}(q) & \mathbb{I}_{n-m}
    \end{bmatrix}}_{J_\mathrm{h}^{-\top}(q)} \left ( \begin{bmatrix}
        G_\mathrm{a}(q)\\ G_\mathrm{u}(q)
    \end{bmatrix} + \begin{bmatrix}
        K_\mathrm{a}(q)\\ K_\mathrm{u}(q)
    \end{bmatrix} + \begin{bmatrix}
        D_\mathrm{aa}(q) & D_\mathrm{au}(q)\\ 
        D_\mathrm{ua}(q) & D_\mathrm{uu}(q)
    \end{bmatrix} \, \dot{q} \right ) = \begin{bmatrix}
        \tau\\ 0_{n-m}
    \end{bmatrix},
\end{equation}
where $G_\mathrm{a}(q), K_\mathrm{a}(q) \in \mathbb{R}^{m}$, $G_\mathrm{u}(q), K_\mathrm{u}(q) \in \mathbb{R}^{n-m}$, and $D_\mathrm{aa} \in \mathbb{R}^{m \times m}$, $D_\mathrm{au} \in \mathbb{R}^{m \times (n-m)}$, $D_\mathrm{ua} \in \mathbb{R}^{(n-m) \times m}$, $D_\mathrm{uu} \in \mathbb{R}^{(n-m) \times (n-m)}$.
We can simplify the expression while leveraging the structure of $J_\mathrm{h}^{-\top}$
\begin{equation}\footnotesize
    \begin{bmatrix}
        M_{\varphi,\mathrm{aa}}(q) & M_{\varphi,\mathrm{au}}(q)\\ 
        M_{\varphi,\mathrm{ua}}(q) & M_{\varphi,\mathrm{uu}}(q)
    \end{bmatrix} \, \ddot{\varphi} + \begin{bmatrix}
        \eta_{\varphi,\mathrm{a}}(q,\dot{q})\\ \eta_{\varphi,\mathrm{u}}(q,\dot{q})
    \end{bmatrix} \, \dot{\varphi} + \begin{bmatrix}
        A_\mathrm{a}^{-1}(q) \left ( G_\mathrm{a}(q) + K_\mathrm{a}(q) \right )\\
        -A_\mathrm{u}(q) \, A_\mathrm{a}^{-1}(q) \left ( G_\mathrm{a}(q) + K_\mathrm{a}(q) \right ) + G_\mathrm{u}(q) + K_\mathrm{u}(q)
    \end{bmatrix} + \underbrace{\begin{bmatrix}
        D_{\varphi,\mathrm{a}}(q)\\
        D_{\varphi,\mathrm{u}}(q)
    \end{bmatrix}}_{D_\varphi(q)} \, \dot{\varphi} = \begin{bmatrix}
        \tau\\ 0_{n-m}
    \end{bmatrix},
\end{equation}
where $D_{\varphi}(q) \succ 0 \in \mathbb{R}^{n \times n}$ is the damping matrix in actuation coordinates\footnote{As $D \succ 0$ and $\mathrm{rank}(J_\mathrm{h}^{-1}(q)) = n \: \forall q \in \mathcal{Q} $, we can conclude that $D_{\varphi}(q) \succ 0 \: \forall q \in \mathcal{Q}$, which will be crucial for the stability proof of many controllers.}
\begin{equation}\small
\begin{split}
    D_{\varphi}(q) =& \: J_\mathrm{h}^{-\top}(q) \, D \, J_\mathrm{h}^{-1}(q) \succ 0,\\
    =& \:  \begin{bmatrix}
         A_\mathrm{a}^{-1}(q) \, D_\mathrm{aa} \, A_\mathrm{a}^{-\top}(q) & -A_\mathrm{a}^{-1}(q) \, D_\mathrm{aa} \, A_\mathrm{a}^{-\top}(q) \, A_\mathrm{u}^\top(q) + A_\mathrm{a}^{-1}(q) \,  D_\mathrm{ua}\\
         -A_\mathrm{u}(q) \, A_\mathrm{a}^{-1}(q) \, D_\mathrm{aa} \, A_\mathrm{a}^{-\top}(q) + D_\mathrm{au} \, A_\mathrm{a}^{-\top}(q) & -A_\mathrm{u}(q) \, A_\mathrm{a}^{-1}(q) \, D_\mathrm{ua} + D_\mathrm{uu}
    \end{bmatrix},
\end{split}
\end{equation}
$\eta_{\varphi,\mathrm{a}}(q,\dot{q}) \in \mathbb{R}^{m \times n}$, $\eta_{\varphi,\mathrm{u}}(q,\dot{q}) \in \mathbb{R}^{(n-m) \times n}$, $M_{\varphi,\mathrm{aa}}(q) \in \mathbb{R}^{m \times m}$, $M_{\varphi,\mathrm{uu}}(q) \in \mathbb{R}^{(n-m) \times (n-m)}$, and $M_{\varphi,\mathrm{ua}}(q) \in \mathbb{R}^{(n-m) \times m}$, and $M_{\varphi,\mathrm{au}}(q) \in \mathbb{R}^{m \times (n-m)}$.

Assuming access to the inverse map $q = h^{-1}(\varphi)$, we can also directly map the potential and kinetic energy of the system into the new coordinates:
\begin{equation}
    \mathcal{T}_\varphi(\varphi, \dot{\varphi}) = \mathcal{T}\left ( q, \dot{q} \right ) \big |_{q=h^{-1}(\varphi), \, \dot{q}=J_\mathrm{h}^{-1} \, \varphi},
    \qquad
    \mathcal{U}_\varphi(\varphi) = \mathcal{U}\left ( q \right ) \big |_{q=h^{-1}(\varphi)}.
\end{equation}
Therefore, we can write the dynamics equivalently as
\begin{equation}
    \begin{bmatrix}
        M_{\varphi,\mathrm{aa}}(q) & M_{\varphi,\mathrm{au}}(q)\\ 
        M_{\varphi,\mathrm{ua}}(q) & M_{\varphi,\mathrm{uu}}(q)
    \end{bmatrix} \, \ddot{\varphi} + \begin{bmatrix}
        \eta_{\varphi,\mathrm{a}}(q,\dot{q})\\ \eta_{\varphi,\mathrm{u}}(q,\dot{q})
    \end{bmatrix} \, \dot{\varphi} + \begin{bmatrix}
        \partial_{\varphi_\mathrm{a}} \mathcal{U}_\varphi(q)\\
        \partial_{\varphi_\mathrm{u}} \mathcal{U}_\varphi(q)
    \end{bmatrix} + \begin{bmatrix}
        D_{\varphi,\mathrm{a}}(q)\\
        D_{\varphi,\mathrm{u}}(q)
    \end{bmatrix} \dot{\varphi} = \begin{bmatrix}
        \tau\\ 0_{n-m}
    \end{bmatrix},
\end{equation}
with $\partial_\varphi \mathcal{U}(\varphi) = \frac{\partial }{\partial \varphi}  \mathcal{U}_\varphi(\varphi) \in \mathbb{R}^n$ the potential forces.

\subsubsection{Fully Actuated Dynamics}
Here, we note some expressions of the actuation space dynamics in the fully-actuated case (i.e., $n=m$).
For example, we can observe that
\begin{equation}
    J_\mathrm{h}(q) = A^\top(q) \in \mathbb{R}^{n \times n},
    \qquad
    J_\mathrm{h}^{-1}(q) = A^{-\top}(q),
    \qquad
    J_{\mathrm{h},\mathrm{M}}^{+\top}(q) = J_\mathrm{h}^{-\top}(q) = A^{-1}(q),
\end{equation}
which leads to the actuation space dynamics
\begin{equation}\small
    \underbrace{A^{-1}(q) \, M(q) \, A^{-\top}(q)}_{M_\varphi(q) \succ 0} \, \ddot{\varphi} + n_\varphi(q,\dot{q}) \, \dot{\varphi} + A^{-1}(q) \left ( G(q) + K(q) \right ) + \underbrace{A^{-1} (q) \, D \, A^{-\top} (q)}_{D_\varphi(q) \succ 0} \, \dot{\varphi} = \tau,
\end{equation}
where
\begin{equation}
    n_\varphi(q,\dot{q}) = A^{-1}(q) \, C(q,\dot{q}) \, A^{-\top}(q) - A^{-1}(q) \, M(q) \, A^{-\top}(q) \, \dot{A}^\top(q) \, A^{-\top} (q).
\end{equation}

\paragraph{Constant Actuation Matrix.} In the case of a constant actuation matrix $A(q) = A$, the map $h(q)$ is now given by $\varphi = A^\top q$, which renders the damping matrix to not be configuration-dependent anymore: $D_\varphi \succ 0$. Furthermore, the actuation space Coriolis matrix simplifies to
\begin{equation}
    \eta_\varphi(q,\dot{q}) = A^{-1} \, C(q,\dot{q}) \, A^{-\top}.
\end{equation}
Finally, in case of linear elasticity $K(q) = S \, q$, we can define
\begin{equation}
    K_\varphi(\varphi) = \underbrace{A^{-1} \, S \, A^{-\top}}_{S_\varphi} \, \varphi = S_\varphi \, \varphi,
\end{equation}
where $S_\varphi \succ 0$ if $S \succ 0$.

\subsubsection{End-to-End Mapping from Actuation into Task Space}
At least in the fully-actuated case with a square matrix $A(q)$, which we additionally also assume to be invertible, we can formulate an end-to-end mapping of velocities and forces between actuation and task space.
Specifically, as $\dot{q} = J_\mathrm{h}^{-1}(q) \, \dot{\varphi} = A^{-\top}(q) \, \dot{\varphi}$~\citep{pustina2024input}, we can state
\begin{equation}
    \dot{x} = J(q) \, \dot{q} = \underbrace{J(q) \, J_\mathrm{h}^{-1}(q) }_{J_{\varphi \to x}(q)} \, \dot{\varphi},
    \qquad
    \tau = J_{\varphi \to x}^\top(q) \, f,
\end{equation}
where $f \in \mathbb{R}^{o}$ are forces in task space. 